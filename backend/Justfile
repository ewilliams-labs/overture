set shell := ["bash", "-cu"]
set dotenv-load := true

start:
    go run cmd/api/main.go

setup:
    go mod tidy
    chmod +x scripts/demo_flow.sh

clean:
    rm -f .last_playlist_id overture.db overture /tmp/overture*.log

demo-create:
    chmod +x scripts/demo_flow.sh
    ./scripts/demo_flow.sh create-playlist "Demo Vibes"

demo-add:
    chmod +x scripts/demo_flow.sh
    ./scripts/demo_flow.sh add-track "Levitating" "Dua Lipa"

demo: demo-create demo-add

run: start

tidy:
	go mod tidy

test:
    go test -v ./...

# Run full integration suite against a running server
validate:
    ./scripts/env-setup.sh ./scripts/with-server.sh ./scripts/validate-acceptance.sh

# Complete CI pipeline: build, run, validate, kill
ci-check:
    ./scripts/env-setup.sh ./scripts/with-server.sh ./scripts/validate-api.sh