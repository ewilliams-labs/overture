[
  {
    "id": "health-check",
    "method": "GET",
    "path": "/health",
    "expected_status": 200
  },
  {
    "id": "valid-track-addition",
    "method": "POST",
    "path": "/playlists/{{playlist_id}}/tracks",
    "payload": { "title": "Blinding Lights", "artist": "The Weeknd" },
    "expected_status": 201
  },
  {
    "id": "fuzzy-match-validation",
    "method": "POST",
    "path": "/playlists/{{playlist_id}}/tracks",
    "payload": { "title": "Blinding Lights - Remastered 2020", "artist": "The Weeknd" },
    "expected_status": 201
  },
  {
    "id": "get-playlist-with-tracks",
    "method": "GET",
    "path": "/playlists/{{playlist_id}}",
    "expected_status": 200,
    "expected_json_path": ".tracks | length",
    "expected_json_min": 1
  },
  {
    "id": "get-playlist-analysis",
    "method": "GET",
    "path": "/playlists/{{playlist_id}}/analysis",
    "expected_status": 200,
    "expected_json_path": ".danceability",
    "expected_json_min": 0
  },
  {
    "id": "complex-intent-parsing",
    "method": "POST",
    "path": "/playlists/{{playlist_id}}/intent",
    "payload": { "message": "Give me Willie Nelson style songs with no auto-tune" },
    "expected_status": 200,
    "expected_body_contains": "vibe_constraints\".*explanation"
  },
  {
    "id": "worker-job-submission",
    "method": "POST",
    "path": "/playlists/{{playlist_id}}/tracks",
    "payload": { "title": "Levitating", "artist": "Dua Lipa" },
    "expected_status": 201
  },
  {
    "id": "verify-audio-analysis-persistence",
    "method": "GET",
    "path": "/playlists/{{playlist_id}}",
    "expected_status": 200,
    "poll_json_path": ".tracks[-1].features.energy",
    "poll_json_min": 0.0001,
    "poll_interval_ms": 500,
    "poll_timeout_ms": 3000
  },
  {
    "id": "fail-on-low-confidence",
    "method": "POST",
    "path": "/playlists/{{playlist_id}}/tracks",
    "payload": { "title": "A Very Obscure Song That Doesnt Exist", "artist": "No One" },
    "expected_status": 422
  },
  {
    "id": "missing-playlist-returns-404",
    "method": "GET",
    "path": "/playlists/does-not-exist",
    "expected_status": 404,
    "expected_body_contains": "domain: not found"
  }
]