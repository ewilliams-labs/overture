set shell := ["bash", "-cu"]
set dotenv-load := true

run:
	go run cmd/api/main.go

tidy:
	go mod tidy

test:
	go test ./...

# Run full integration suite against a running server
validate-acceptance:
    chmod +x ./scripts/validate_api.sh
    ./scripts/validate_api.sh

# Complete CI pipeline: build, run, validate, kill
ci-check:
    go build -o overture ./cmd/server
    ./overture & PID=$!; \
    sleep 3; \
    make validate-acceptance; \
    EXIT_CODE=$?; \
    kill $PID; \
    exit $EXIT_CODE